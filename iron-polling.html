<link rel="import" href="../polymer/polymer.html">

<!--
`iron-polling`
polls using the iron-ajax element at a given frequency

@demo demo/index.html
-->

<link rel="import" href="../iron-ajax/iron-ajax.html">

<dom-module id="iron-polling">
    <template>

       <iron-ajax auto
        url="{{url}}"
        params="{{params}}"
        handle-as="{{handleAs}}"
        id="ajaxCall"
        last-response="{{ajaxResponse}}"
        on-response="handleResponse"
        debounce-duration="300">
      </iron-ajax>

  </template>

    <script>
        Polymer({

            is: 'iron-polling',

            properties: {
                lastPollingDate: {
                    type: Date,
                    value: null
                },
                pollingFrequency: {
                    type: Number,
                    value: 10
                },
                url: {
                    type: String
                },
                params: {
                    type: Object,
                    value: function() {
                        return {};
                    }
                },
                handleAs: {
                    type: String,
                    value: 'json'
                },
                timeout: {
                    type: Number,
                    value: 0
                },
                lastResponse: {
                    type: Object,
                    notify: true,
                    readOnly: true
                },
                lastError: {
                    type: Object,
                    notify: true,
                    readOnly: true
                }
            },

            ready: function() {
                this.refreshLastPoll();
            },

            handleResponse: function() {
                this.async(function() {
                    this.poll();
                }, this.pollingFrequency * 1000);
            },

            poll: function() {
                this.$.ajaxCall.generateRequest();
                this.refreshLastPoll();
            },

            refreshLastPoll: function() {
                this.lastPoll = new Date();
            }

        });
    </script>
</dom-module>
